var Dispatcher = require('../services/AppDispatcher');
var EventEmitter = require('events').EventEmitter;
var assign = require('object-assign');
var AdminAppConstants = require('../constants/AdminAppConstants');

var LOGIN_EVENT = "login";
var LOGIN_SUCCESS = "login_success";
var FIND_USERS = "find_users";
var REGISTER ="register";

var getConnectionsInfo = {
    connectionList : []
};

var AdminAppStore = assign({}, EventEmitter.prototype, {
    getConnectionList : function(){
	return getConnectionsInfo
    },

    emitConnectionListChange : function(err){
	this.emit(FIND_USERS, err);
    },

    addConnectionListListener : function(fn){
	this.on(FIND_USERS, fn);
    },

    removeConnectionListListner : function(fn){
	this.removeListener(FIND_USERS, fn);
    },

    addRegisterListener : function(fn){
	this.on(REGISTER, fn);
    },

    removeRegisterListener : function(fn){
	this.removeListener(REGISTER, fn)
    },

    emitRegistered : function(err, info){
	this.emit(REGISTER, err, info)
    }
});

    
Dispatcher.register(function(action){
    switch(action.type){
 
    case AdminAppConstants.FIND_USER :
	if(action.success){
	    getConnectionInfo.connectionList = action.connectionList;
	    AdminAppStore.emitConnectionListChange();
	} else {
	    AdminAppStore.emitConnectionListChange(action.errorMessage);
	}
	break;

    case AdminAppConstants.FIND_USERS :
	if(action.success){
	    console.log(action)
	    getConnectionsInfo.connectionList = action.connectionList.Connections;
	    AdminAppStore.emitConnectionListChange();
	} else {
	    AdminAppStore.emitConnectionListChange(action.errorMessage);
	}
	break;

    case AdminAppConstants.REGISTER :
	if(action.success){
	    console.log("success")
	    AdminAppStore.emitRegistered(null, action.nodeInfo);
	} else {
	    console.log(action)
	    AdminAppStore.emitRegistered(action.errorMessage);
	}
	break;
    default :
	console.log("no op");
    }
});

module.exports = AdminAppStore;
		






